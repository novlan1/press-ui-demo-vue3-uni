import{t as e}from"./time.V88eNYkT.js";import{s as t}from"./index.CF1Gtrup.js";import{_ as n,a3 as a,z as i,G as o,a4 as r,x as l,c as u,d as s,a5 as m,r as c,o as p,g as h,w as d,a6 as y,a7 as f,H as P,a8 as g,k as D,e as k,t as C,P as v}from"./index-DDfOvTF0.js";import{P as w}from"./press-popup.DsL_WtHb.js";const x=(e,t)=>"yearMonth"===e?function(e){const{year:t,month:n}=$(e);return`${t}/${n}`}(t):t,M="yearMonth-day-hour-minute",T="yearMonth";function $(e){const t=e%12,n=parseInt(""+(e-t)/12,10);return t?{year:n,month:t}:{year:n-1,month:12}}const I=(new Date).getFullYear();function b(e,t,n){return Math.min(Math.max(e,t),n)}function O(e){return`00${e}`.slice(-2)}function V(e){for(void 0===e&&(e="1");isNaN(parseInt(e,10));)e=e.slice(1);return parseInt(e,10)}function H(e,t){return 32-new Date(e,t-1,32).getDate()}const F=n({name:"PressDatetimePicker",options:{...i,styleIsolation:"shared"},components:{PressPicker:a},props:Object.assign(Object.assign({},r),{...l,value:{type:null},filter:{type:[Function,null],default:null},type:{type:String,default:"datetime"},showToolbar:{type:Boolean,default:!0},formatter:{type:[Function,null],default:x},minDate:{type:Number,default:new Date(I-10,0,1).getTime()},maxDate:{type:Number,default:new Date(I+10,11,31).getTime()},minHour:{type:Number,default:0},maxHour:{type:Number,default:23},minMinute:{type:Number,default:0},maxMinute:{type:Number,default:59},immediateCheck:{type:Boolean,default:!1},activeClass:{type:String,default:""},toolbarClass:{type:String,default:""},columnClass:{type:String,default:""},useMomentum:{type:Boolean,default:!1},swipeDuration:{type:[Number,String],default:1e3}}),emits:["cancel","confirm","input","change"],data:()=>({innerValue:Date.now(),columns:[],firstUpdateColumnValue:!1}),watch:{value:{handler(){this.updateValue()}},type:{handler(){this.updateValue()}},minDate:{handler(){this.updateValue()}},maxDate:{handler(){this.updateValue()}},minHour:{handler(){this.updateValue()}},maxHour:{handler(){this.updateValue()}},minMinute:{handler(){this.updateValue()}},maxMinute:{handler(){this.updateValue()}}},mounted(){this.init()},methods:{setData(e){Object.keys(e).forEach((t=>{this[t]=e[t]}))},set(e){return this.setData(e),new Promise((e=>o(e)))},updateValue(){const e=this.correctValue(this.value),t=e===this.innerValue;this.updateColumnValue(e).then((()=>{t||this.$emit("input",e)}))},getPicker(){if(null==this.picker){this.picker=this.$refs.pressPicker;const{picker:e}=this,{setColumnValues:t}=e;e.setColumnValues=(...n)=>t.apply(e,[...n,!1])}return this.picker},updateColumns(){const e=this.formatter||x,t=this.getOriginColumns().map((t=>({values:t.values.map((n=>e(t.type,n,this.innerValue)))})));return this.set({columns:t})},getOriginColumns(){const{filter:e,innerValue:t}=this;return this.getRanges().map((({type:n,range:a})=>{let i=function(e,t){let n=0;const a=Array(e<0?0:e);for(;n<e;)a[n]=t(n),n+=1;return a}(a[1]-a[0]+1,(e=>{const t=a[0]+e;return"year"===n||n===T?`${t}`:O(t)}));return e&&(i=e(n,i,t)),{type:n,values:i}}))},getRanges(){if("time"===this.type)return[{type:"hour",range:[this.minHour,this.maxHour]},{type:"minute",range:[this.minMinute,this.maxMinute]}];const{maxYear:e,maxDate:t,maxMonth:n,maxHour:a,maxMinute:i,maxYearMonth:o}=this.getBoundary("max",this.innerValue),{minYear:r,minDate:l,minMonth:u,minHour:s,minMinute:m,minYearMonth:c}=this.getBoundary("min",this.innerValue),p=[{type:"year",range:[r,e]},{type:"month",range:[u,n]},{type:"day",range:[l,t]},{type:"hour",range:[s,a]},{type:"minute",range:[m,i]}];if("date"===this.type&&p.splice(3,2),"year-month"===this.type&&p.splice(2,3),this.type===M){return[{type:T,range:[c,o]},{type:"day",range:[l,t]},{type:"hour",range:[s,a]},{type:"minute",range:[m,i]}]}return p},correctValue(e){const t="time"!==this.type;if(t&&(!m(n=e)||isNaN(new Date(n).getTime())))e=this.minDate;else if(!t&&!e){const{minHour:t}=this;e=`${O(t)}:00`}var n;if(!t){let[t,n]=e.split(":");return t=O(b(t,this.minHour,this.maxHour)),n=O(b(n,this.minMinute,this.maxMinute)),`${t}:${n}`}return e=Math.max(e,this.minDate),e=Math.min(e,this.maxDate)},getBoundary(e,t){const n=new Date(t),a=new Date(this[`${e}Date`]),i=a.getFullYear();let o=1,r=1,l=0,u=0;"max"===e&&(o=12,r=H(n.getFullYear(),n.getMonth()+1),l=23,u=59),n.getFullYear()===i&&(o=a.getMonth()+1,n.getMonth()+1===o&&(r=a.getDate(),n.getDate()===r&&(l=a.getHours(),n.getHours()===l&&(u=a.getMinutes()))));const s=12*i+o;return{[`${e}Year`]:i,[`${e}Month`]:o,[`${e}Date`]:r,[`${e}Hour`]:l,[`${e}Minute`]:u,[`${e}YearMonth`]:s}},onCancel(){this.$emit("cancel")},onConfirm(){this.$emit("confirm",this.innerValue)},onChange(){let e;const t=this.getPicker(),n=this.getOriginColumns();if("time"===this.type){const a=t.getIndexes();e=`${+n[0].values[a[0]]}:${+n[1].values[a[1]]}`}else{const a=t.getIndexes().map(((e,t)=>n[t].values[e]));let i=V(a[0]),o=V(a[1]);const r=H(i,o);let l=V(a[2]);"year-month"===this.type&&(l=1),l=l>r?r:l;let u=0,s=0;if("datetime"===this.type&&(u=V(a[3]),s=V(a[4])),this.type===M){const e=$(a[0]);i=e.year,o=e.month,l=V(a[1]),u=V(a[2]),s=V(a[3])}e=new Date(i,o-1,l,u,s)}e=this.correctValue(e),this.updateColumnValue(e).then((()=>{this.$emit("input",e),this.$emit("change",t)}))},updateColumnValue(e){let t=[];const{type:n,innerValue:a}=this,i=this.formatter||x,o=this.getPicker();if("time"===n){const n=e.split(":");t=[i("hour",n[0],a),i("minute",n[1])]}else{const o=new Date(e);t=[i("year",`${o.getFullYear()}`,a),i("month",O(o.getMonth()+1),a)],"date"===n&&t.push(i("day",O(o.getDate()),a)),"datetime"===n&&t.push(i("day",O(o.getDate()),a),i("hour",O(o.getHours()),a),i("minute",O(o.getMinutes()),a)),n===M&&(t=[i(T,12*o.getFullYear()+o.getMonth()+1,a),i("day",O(o.getDate()),a),i("hour",O(o.getHours()),a),i("minute",O(o.getMinutes()),a)])}return this.set({innerValue:e}).then((()=>this.updateColumns())).then((()=>{var e;(null==(e=o.children)?void 0:e.length)&&o.setValues(t)}))},afterSetColumns(){},init(){const e=this.correctValue(this.value);this.updateColumnValue(e,!0).then((()=>{this.immediateCheck?this.onChange():this.$emit("input",e)}))}}},[["render",function(e,t,n,a,i,o){const r=c("PressPicker");return p(),u("div",{class:"press-datetime-picker-index"},[s(r,{ref:"pressPicker",class:"press-datetime-picker","active-class":e.activeClass,"toolbar-class":e.toolbarClass,"column-class":e.columnClass,title:e.title,columns:i.columns,"item-height":e.itemHeight,"show-toolbar":e.showToolbar,"visible-item-count":e.visibleItemCount,"confirm-button-text":e.confirmButtonText,"cancel-button-text":e.cancelButtonText,"use-momentum":e.useMomentum,"swipe-duration":e.swipeDuration,onChange:o.onChange,onConfirm:o.onConfirm,onCancel:o.onCancel,onAfterSetColumns:o.afterSetColumns},null,8,["active-class","toolbar-class","column-class","title","columns","item-height","show-toolbar","visible-item-count","confirm-button-text","cancel-button-text","use-momentum","swipe-duration","onChange","onConfirm","onCancel","onAfterSetColumns"])])}]]);const _=n({name:"PressDatetimePickerPopupPlus",components:{PressPopup:w,PressDatetimePicker:F},props:{show:{type:Boolean,default:!1},closeOnClickOverlay:{type:Boolean,default:!0},datetimePicker:{type:Object,default:()=>({})},formatter:{type:[Function,null],default:x},filter:{type:[Function,null],default:null},zIndex:{type:Number,default:100}},data:()=>({}),methods:{input(e){this.$emit("input",e)},cancel(...e){this.$emit("cancel",...e)},confirm(...e){this.$emit("confirm",...e)},clickOverlay(){this.$emit("click-overlay")}}},[["render",function(e,t,n,a,i,o){const r=c("PressDatetimePicker"),l=c("PressPopup");return p(),h(l,{show:n.show,"z-index":n.zIndex,position:"bottom","close-on-click-overlay":n.closeOnClickOverlay,onClickOverlay:o.clickOverlay,onClose:o.cancel},{default:d((()=>[s(r,{value:n.datetimePicker.value,"show-toolbar":n.datetimePicker.showToolbar||!1,"item-height":n.datetimePicker.itemHeight||56,type:n.datetimePicker.type||"datetime","max-date":n.datetimePicker.maxDate,"min-date":n.datetimePicker.minDate,"immediate-check":n.datetimePicker.immediateCheck,title:n.datetimePicker.title||"",formatter:n.formatter,filter:n.filter,onInput:o.input,onCancel:o.cancel,onConfirm:o.confirm},null,8,["value","show-toolbar","item-height","type","max-date","min-date","immediate-check","title","formatter","filter","onInput","onCancel","onConfirm"])])),_:1},8,["show","z-index","close-on-click-overlay","onClickOverlay","onClose"])}]]);let S;const Y={...g,datetimePicker:{type:Object,default:()=>({})},tip:{type:String,default:""}},E={name:"PressDatetimePickerPopup",options:{...P(!0,!1)},components:{PressPopupPlus:f,PressDatetimePicker:F},mixins:[y(Y)],props:{},emits:[],data(){return{currentValue:this.getPropOrData("datetimePicker.value")}},computed:{immediateCheck(){return this.getPropOrData("datetimePicker.immediateCheck")||!0}},watch:{},created(){S=this},mounted(){},methods:{noop(){},emitEvent(e){const t={context:this,value:this.currentValue};this.$emit(e),this.promiseCallback(e,t)},confirm(){this.emitEvent("confirm")},cancel(){this.emitEvent("cancel")},onInput(e){var t;this.currentValue=e,null==(t=this.getPropOrData("datetimePicker.input"))||t(e)},timeFilter(e,t,n){const a=S.getPropOrData("datetimePicker.filter")||null;return a?a(e,t,n):t},timeFormatter(e,t,n){const a=S.getPropOrData("datetimePicker.formatter")||null;return a?a(e,t,n):t}}};let N;const B="press-picker-functional",z=31536e6,j=t=>`${e(t,"yyyy-MM-dd hh:mm")}`;const A=n({i18n:{"zh-CN":{day:"日",year:"年",month:"月",hour:"时",minute:"分",timeType:"选择时间",dateType:"选择年月日",datetimeType:"选择完整时间",dateHourType:"选择年月日小时",monthDayType:"选择月日",yearMonthType:"选择年月",optionFilter:"选项过滤器",yearMonth:"年月合并",sortColumns:"自定义列排序",withPopup:"搭配弹出层使用",functional:"函数式调用"},"en-US":{day:" Day",year:" Year",month:" Month",hour:"Hour",minute:"Minute",timeType:"Choose Time",dateType:"Choose Date",datetimeType:"Choose DateTime",dateHourType:"Choose DateHour",monthDayType:"Choose Month-Day",yearMonthType:"Choose Year-Month",optionFilter:"Option Filter",yearMonth:"Year With Month",sortColumns:"Columns Order",withPopup:"With Popup",functional:"Functional Mode"}},components:{PressDatetimePicker:F,PressDatetimePickerPopup:n(E,[["render",function(e,t,n,a,i,o){const r=c("PressDatetimePicker"),l=c("PressPopupPlus");return e.innerShow?(p(),u("div",{key:0,class:"press-datetime-picker-popup"},[s(l,{"show-title":e.getPropOrData("showTitle"),"close-icon":e.getPropOrData("closeIcon"),"arrow-icon":e.getPropOrData("arrowIcon"),title:e.getPropOrData("title"),button:e.getPropOrData("button"),"border-button":e.getPropOrData("borderButton"),"z-index":e.getPropOrData("zIndex"),"popup-class":e.getPropOrData("popupClass"),"close-on-click-overlay":e.getPropOrData("closeOnClickOverlay"),"custom-style":e.getPropOrData("customStyle"),onConfirm:o.confirm,onCancel:o.cancel},{default:d((()=>[k("div",{class:"press-datetime-picker-popup__picker"},[s(r,{ref:"picker",value:e.getPropOrData("datetimePicker.value"),"show-toolbar":e.getPropOrData("datetimePicker.showToolbar")||!1,"item-height":e.getPropOrData("datetimePicker.itemHeight")||56,type:e.getPropOrData("datetimePicker.type")||"datetime","max-date":e.getPropOrData("datetimePicker.maxDate"),"min-date":e.getPropOrData("datetimePicker.minDate"),"immediate-check":o.immediateCheck,formatter:o.timeFormatter,filter:o.timeFilter,onInput:o.onInput},null,8,["value","show-toolbar","item-height","type","max-date","min-date","immediate-check","formatter","filter","onInput"])]),e.tip?(p(),u("div",{key:0,class:"press-datetime-picker-popup__tip"},C(e.tip),1)):D("",!0)])),_:1},8,["show-title","close-icon","arrow-icon","title","button","border-button","z-index","popup-class","close-on-click-overlay","custom-style","onConfirm","onCancel"])])):D("",!0)}],["__scopeId","data-v-21ad4fc6"]]),PressCell:v,PressDatetimePickerPopupPlus:_},data(){N=this;const e=(new Date).getTime(),t=new Date(2036,10,1).getTime();return{minHour:10,maxHour:20,minDate:e,maxDate:t,yearMonthMaxDate:new Date(2036,10,1).getTime(),currentDate:(new Date).getTime(),currentTime:"12:00",filter:(e,t)=>"minute"===e?t.filter((e=>e%5==0)):t,DATE_TIME_PICKER_ID:B,datetimePicker:{value:(new Date).getTime(),minDate:(new Date).getTime()-z,maxDate:(new Date).getTime()+z,input(e){N.onInput(e)}},popupPlus:{show:!1,closeOnClickOverlay:!0,datetimePicker:{showToolbar:!0,minDate:e,maxDate:t,title:"选择时间"}},normalCellValue:"",eSportCellValue:""}},methods:{formatter(e,t){const n=N.t("year"),a=N.t("month"),i=N.t("day"),o=N.t("hour"),r=N.t("minute");return"year"===e?`${t}${n}`:"month"===e?`${t}${a}`:"day"===e?`${t}${i}`:"hour"===e?`${t}${o}`:"minute"===e?`${t}${r}`:void 0},yearMonthFormatter(e,t,n){const a=N.t("year"),i=N.t("month"),o=N.t("day"),r=N.t("hour"),l=N.t("minute"),{year:u,month:s}=$(t);return"yearMonth"===e?`${`${u}`.slice(2,4)}${a}${s}${i}`:"day"===e?((e,t,n)=>{const a=new Date(n),i=a.getFullYear(),o=a.getMonth()+1,r=new Date(`${i}/${o}/${e}`),l=r.getDay(),u=r.getDate(),s=new Date,m=s.getFullYear(),c=s.getMonth()+1,p=s.getDate();return i===m&&o===c&&u===p?"今日":`${e}${t} ${{1:"周一",2:"周二",3:"周三",4:"周四",5:"周五",6:"周六",0:"周日"}[l]}`})(t,o,n):"hour"===e?`${t}${r}`:"minute"===e?`${t}${l}`:void 0},onInput(e){this.currentDate=e,this.onTip(j(e))},onInputTime(e){this.currentTime=e,this.onTip(e)},onShowFunctionalPicker(){let e="";t.call(this,{context:this,selector:`#${B}`,title:this.t("timeType"),button:this.t("confirm"),horizontal:!1,closeIcon:!1,arrowIcon:!1,borderButton:!1,customStyle:"",datetimePicker:{value:(new Date).getTime(),minDate:(new Date).getTime()-z,maxDate:(new Date).getTime()+z,input(t){N.onInput(t),e=t,console.log("inputValue",e),N.eSportCellValue=j(t)}}}).then(((t={})=>{const{context:n}=t;console.log("inputValue",e),this.onTip("confirm"),n.innerShow=!1})).catch(((e={})=>{const{context:t}=e;this.onTip("cancel"),t.innerShow=!1}))},confirm(){},cancel(){},onTip(e){this.onGTip(`${e}`,1500)},onShowPopupPlus(){this.popupPlus.show=!0},onConfirm(e){this.popupPlus.show=!1,console.log("[confirm]",e),this.onInput(e),this.normalCellValue=j(e)}}},[["render",function(e,t,n,a,i,o){const r=c("PressDatetimePicker"),l=c("demo-block"),m=c("PressCell"),h=c("PressDatetimePickerPopup"),y=c("PressDatetimePickerPopupPlus");return p(),u("div",{class:"demo-wrap"},[s(l,{title:e.t("datetimeType")},{default:d((()=>[s(r,{type:"datetime",value:i.currentDate,"min-date":i.minDate,"max-date":i.maxDate,onInput:o.onInput},null,8,["value","min-date","max-date","onInput"])])),_:1},8,["title"]),s(l,{title:e.t("dateType")},{default:d((()=>[s(r,{type:"date",value:i.currentDate,"min-date":i.minDate,formatter:o.formatter,onInput:o.onInput},null,8,["value","min-date","formatter","onInput"])])),_:1},8,["title"]),s(l,{title:e.t("yearMonthType")},{default:d((()=>[s(r,{type:"year-month",value:i.currentDate,"min-date":i.minDate,onInput:o.onInput},null,8,["value","min-date","onInput"])])),_:1},8,["title"]),s(l,{title:e.t("timeType")},{default:d((()=>[s(r,{type:"time",value:i.currentTime,"min-hour":i.minHour,"max-hour":i.maxHour,onInput:o.onInputTime},null,8,["value","min-hour","max-hour","onInput"])])),_:1},8,["title"]),s(l,{title:e.t("optionFilter")},{default:d((()=>[s(r,{type:"time",value:i.currentTime,filter:i.filter,onInput:o.onInputTime},null,8,["value","filter","onInput"])])),_:1},8,["title"]),s(l,{title:e.t("yearMonth")},{default:d((()=>[s(r,{type:"yearMonth-day-hour-minute",value:i.currentDate,"min-date":i.minDate,"max-date":i.yearMonthMaxDate,formatter:o.yearMonthFormatter,onInput:o.onInput},null,8,["value","min-date","max-date","formatter","onInput"])])),_:1},8,["title"]),s(l,{title:e.t("withPopup")},{default:d((()=>[s(m,{title:"Normal","is-link":"",value:i.normalCellValue,onClick:o.onShowPopupPlus},null,8,["value","onClick"]),s(m,{title:"E-Sport","is-link":"",value:i.eSportCellValue,onClick:o.onShowFunctionalPicker},null,8,["value","onClick"])])),_:1},8,["title"]),s(h,{id:i.DATE_TIME_PICKER_ID,ref:i.DATE_TIME_PICKER_ID,mode:"functional"},null,8,["id"]),s(y,{show:i.popupPlus.show,"datetime-picker":i.popupPlus.datetimePicker,formatter:o.formatter,"close-on-click-overlay":i.popupPlus.closeOnClickOverlay,onCancel:t[0]||(t[0]=e=>i.popupPlus.show=!1),onConfirm:o.onConfirm,onInput:o.onInput},null,8,["show","datetime-picker","formatter","close-on-click-overlay","onConfirm","onInput"])])}]]);export{A as default};
