import{_ as e,b9 as t,i as s,af as r,ag as a,E as i,c as l,e as o,d as n,B as c,n as d,F as u,g as h,t as v,w as p,ba as y,bb as m,o as C,j as f,h as x,r as g}from"./index-DXY-0Hyq.js";import{B as k,W as w}from"./color.IIFrEASq.js";import{a as S}from"./canvas.BtyLL0i2.js";let I=0;const _=2*Math.PI,V=-Math.PI/2;const b=e({i18n:{"zh-CN":{gradient:"渐变色",customSize:"大小定制",customStyle:"样式定制",customColor:"颜色定制",customWidth:"宽度定制",counterClockwise:"逆时针"},"en-US":{gradient:"Gradient",customSize:"Size",customStyle:"Custom Style",customColor:"Color",customWidth:"Width",counterClockwise:"Direction"}},components:{PressCircle:e({name:"PressCircle",props:{text:{type:String,default:""},lineCap:{type:String,default:"round"},value:{type:Number,default:0},speed:{type:Number,default:50},size:{type:Number,default:100},fill:{type:String,default:""},layerColor:{type:String,default:w},color:{type:null,default:k},type:{type:String,default:""},strokeWidth:{type:Number,default:4},clockwise:{type:Boolean,default:!0}},emits:[],data:()=>({hoverColor:k,id:1,isNotInUni:s()}),computed:{circleStyle(){const{size:e}=this;return`width: ${i.addUnit(e)};height: ${i.addUnit(e)}`},canvasId(){return`press-circle-${this.id}`}},watch:{value:{handler(){this.reRender()}},size:{handler(){this.drawCircle(this.currentValue)}},color:{handler(){this.setHoverColor().then((()=>{this.drawCircle(this.currentValue)}))}}},created(){I+=1,this.id=I},mounted(){this.currentValue=this.value,this.setHoverColor().then((()=>{this.drawCircle(this.currentValue)}))},destroyed(){this.onDestroyed()},unmounted(){this.onDestroyed()},methods:{onDestroyed(){this.clearMockInterval()},getContext(){const{type:e,size:t}=this;if(s()){const e=window.devicePixelRatio,s=document.getElementById(this.canvasId),r=s.getContext("2d");return this.inited||(this.inited=!0,s.width=t*e,s.height=t*e,r.scale(e,e)),Promise.resolve(S(r))}if(""===e||!r()){const e=uni.createCanvasContext(this.canvasId,this);return Promise.resolve(e)}const i=a().pixelRatio;return new Promise((s=>{uni.createSelectorQuery().in(this).select(`#${this.canvasId}`).node().exec((r=>{const a=r[0].node,l=a.getContext(e);this.inited||(this.inited=!0,a.width=t*i,a.height=t*i,l.scale(i,i)),s(S(l))}))}))},setHoverColor(){const{color:e,size:s}=this;return t(e)?this.getContext().then((t=>{const r=t.createLinearGradient(s,0,0,0);Object.keys(e).sort(((e,t)=>parseFloat(e)-parseFloat(t))).map((t=>r.addColorStop(parseFloat(t)/100,e[t]))),this.hoverColor=r})):(this.hoverColor=e,Promise.resolve())},presetCanvas(e,t,s,r,a){const{strokeWidth:i,lineCap:l,clockwise:o,size:n}=this,c=n/2,d=c-i/2;e.setStrokeStyle(t),e.setLineWidth(i),e.setLineCap(l),e.beginPath(),e.arc(c,c,d,s,r,!o),e.stroke(),a&&(e.setFillStyle(a),e.fill())},renderLayerCircle(e){const{layerColor:t,fill:s}=this;this.presetCanvas(e,t,0,_,s)},renderHoverCircle(e,t){const{clockwise:s}=this,r=_*(t/100),a=s?V+r:3*Math.PI-(V+r);this.presetCanvas(e,this.hoverColor,V,a)},drawCircle(e){const{size:t}=this;this.getContext().then((s=>{s.clearRect(0,0,t,t),this.renderLayerCircle(s);const r=(a=e,Math.min(Math.max(a,0),100));var a;0!==r&&this.renderHoverCircle(s,r),s.draw()}))},reRender(){const{value:e,speed:t}=this;if(t<=0||t>1e3)return void this.drawCircle(e);this.clearMockInterval(),this.currentValue=this.currentValue||0;const s=()=>{this.interval=setTimeout((()=>{this.currentValue!==e?(Math.abs(this.currentValue-e)<1?this.currentValue=e:this.currentValue<e?this.currentValue+=1:this.currentValue-=1,this.drawCircle(this.currentValue),s()):this.clearMockInterval()}),1e3/t)};s()},clearMockInterval(){this.interval&&(clearTimeout(this.interval),this.interval=null)}}},[["render",function(e,t,s,r,a,i){const x=y,g=m;return C(),l("div",{class:"press-circle-index"},[o("div",{class:"press-circle"},[n(x,{id:i.canvasId,class:"press-circle__canvas",type:s.type,style:c(i.circleStyle),"canvas-id":i.canvasId},null,8,["id","type","style","canvas-id"]),s.text?(C(),l(u,{key:1},[a.isNotInUni?(C(),l("div",{key:0,class:"press-circle__text"},v(s.text),1)):(C(),h(g,{key:1,class:"press-circle__text"},{default:p((()=>[f(v(s.text),1)])),_:1}))],64)):(C(),l("div",{key:0,class:"press-circle__text"},[d(e.$slots,"default",{},void 0,!0)]))])])}],["__scopeId","data-v-d85f44ff"]]),PressButton:x},data:()=>({value:20,headerStyle:"background: #f7f8fa;",sectionStyle:"background: #f7f8fa;margin: 0;padding: 0 12px;",gradientColor:{"0%":"#3fecff","100%":"#6149f6"}}),methods:{onChangeCircleValue(e){if("plus"===e){if(this.value>=100)return;this.value+=20}else if("minus"===e){if(this.value<=0)return;this.value-=20}}}},[["render",function(e,t,s,r,a,i){const c=g("PressCircle"),d=g("demo-block"),u=g("PressButton");return C(),l("div",{class:"demo-wrap demo-wrap--gray"},[n(d,{title:e.t("basicUsage"),"header-style":a.headerStyle,"section-style":a.sectionStyle},{default:p((()=>[n(c,{value:a.value,text:`${a.value}%`},null,8,["value","text"])])),_:1},8,["title","header-style","section-style"]),n(d,{title:e.t("customStyle"),"header-style":a.headerStyle,"section-style":a.sectionStyle},{default:p((()=>[o("div",{class:"demo-part"},[n(c,{value:a.value,"stroke-width":6,text:e.t("customWidth")},null,8,["value","text"])]),o("div",{class:"demo-part"},[n(c,{value:a.value,"stroke-width":6,"layer-color":"#eeeeee",color:"#ee0a24",text:e.t("customColor")},null,8,["value","text"])]),o("div",{class:"demo-part"},[n(c,{value:a.value,"stroke-width":6,color:a.gradientColor,text:e.t("gradient")},null,8,["value","color","text"])]),o("div",{class:"demo-part"},[n(c,{value:a.value,"stroke-width":6,color:"#07c160",clockwise:!1,text:e.t("counterClockwise")},null,8,["value","text"])]),o("div",{class:"demo-part"},[n(c,{value:a.value,size:120,text:e.t("customSize")},null,8,["value","text"])]),o("div",null,[n(u,{type:"e-sport-primary","custom-style":"margin-right:8px;",onClick:t[0]||(t[0]=e=>i.onChangeCircleValue("plus"))},{default:p((()=>[f(v(e.t("add")),1)])),_:1}),n(u,{type:"e-sport-primary",onClick:t[1]||(t[1]=e=>i.onChangeCircleValue("minus"))},{default:p((()=>[f(v(e.t("decrease")),1)])),_:1})])])),_:1},8,["title","header-style","section-style"])])}],["__scopeId","data-v-04a23828"]]);export{b as default};
