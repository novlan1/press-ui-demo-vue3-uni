import{bd as e,_ as t,H as i,c as r,e as n,B as s,F as o,f as a,I as l,q as h,o as u,t as c,V as d,a7 as p,g as m,w as v,r as f,k as w,d as y,a6 as g}from"./index-DCu1HSzP.js";import{a as k}from"./rect.f7zOVtkz.js";const C={arrowIcon:"showBackArrow",list:"selectList",current:"selectItem",confirm:"onClickConfirm",cancel:"onRemove"},I=e({arrowIcon:{type:Boolean,default:!1},title:{type:String,default:""},list:{type:Array,default:()=>[],required:!1},current:{type:Object,default:null,required:!1},tip:{type:String,default:"",required:!1},confirm:{type:Function,default:null,required:!1},cancel:{type:Function,default:null,required:!1},virtualListThreshold:{type:Number,default:50},horizontal:{type:Boolean,default:!1}},C);function M(e){return e.changedTouches&&e.changedTouches[0]?e.changedTouches[0]:e.touches&&e.touches[0]?e.touches[0]:e}const x=t({name:"PressPickerView",options:{...i(!0,!1)},props:{data:{type:Array,default:()=>[{label:"test"},{label:"test"},{label:"test"},{label:"test"},{label:"test"},{label:"test"}],required:!0},current:{type:Object,default:null,required:!1},hasTip:{type:Boolean,default:!1,required:!1},virtualListThreshold:{type:Number,default:50},horizontal:{type:Boolean,default:!1}},emits:["currentIndexChanged"],data:()=>({currentIndex:0,currentScroll:0,start:0,startScroll:0,move:0,itemHeight:56,downX:0,downY:0,upX:0,upY:0,lastMove:0,lastTime:0,speed:0,hasClick:!1,slideLimitNum:10,slideTimeThreshold:300}),computed:{upMissed(){const{currentIndex:e,virtualListThreshold:t}=this;return Math.max(0,e-t)},hiddenUpPartStyle(){const{itemHeight:e,upMissed:t}=this;return`height: ${t*e}px;`},hiddenBottomPartStyle(){const{currentIndex:e,data:t,itemHeight:i,virtualListThreshold:r}=this;return`height: ${(t.length-e-r)*i}px;`},showingData(){const{currentIndex:e,virtualListThreshold:t,upMissed:i}=this;return this.data.slice(i,e+t).map(((e,t)=>({...e,uniqueKey:t+i})))},transformStyle(){return`transform: translate3d(0, ${this.currentScroll}px, 0);`},slideLimitDistance(){return this.slideLimitNum*this.itemHeight}},watch:{data(e){return this.updateCurrent(),e},current(e){return this.updateCurrent(),e},currentIndex:{handler(e){this.$emit("currentIndexChanged",e)},deep:!0}},created(){},mounted(){k(this,".press-picker-view--item__active").then((e=>{this.itemHeight=e.height,this.updateCurrent()})),this.updateCurrent(),document.addEventListener("mouseup",this.mouseUp)},beforeDestroy(){this.onBeforeDestroy()},beforeUnmount(){this.onBeforeDestroy()},methods:{onBeforeDestroy(){document.removeEventListener("mouseup",this.mouseUp)},mouseDown(e){document.addEventListener("mousemove",this.mouseMove),this.handleStart(e)},mouseMove(e){this.handleMove(e)},mouseUp(){document.removeEventListener("mousemove",this.mouseMove),this.handleEnd()},handleStart(e){const t=M(e);this.start=null==t?void 0:t.clientY,this.startScroll=this.currentScroll,this.lastMove=0,this.lastTime=(new Date).getTime()},handleMove(e){const t=M(e);this.move=(null==t?void 0:t.clientY)-this.start;let i=this.startScroll+this.move;i=Math.min(0,i),i=Math.max(-(this.data.length-1)*this.itemHeight,i),this.currentScroll=i;const r=Math.round(this.currentScroll/this.itemHeight);this.currentIndex=-r,this.time=(new Date).getTime(),this.time!==this.lastTime&&(this.speed=(this.move-this.lastMove)/(this.time-this.lastTime)),this.lastMove=this.move,this.lastTime=this.time},handleEnd(){if(this.hasClick)return void(this.hasClick=!1);let e=0;(new Date).getTime()-this.lastTime<this.slideTimeThreshold&&(e=this.speed*this.slideTimeThreshold/2,e=Math.min(this.slideLimitDistance,e),e=Math.max(-this.slideLimitDistance,e));let t=this.currentScroll+e;t=Math.min(0,t),t=Math.max(-(this.data.length-1)*this.itemHeight,t);const i=Math.round(t/this.itemHeight);this.currentScroll=i*this.itemHeight,this.currentIndex=-i},getCurrentItem(){return this.data[this.currentIndex]},updateCurrent(){if(this.current){const e=this.data.find((e=>e.value==this.current.value));this.currentIndex=this.data.indexOf(e),this.currentScroll=-this.currentIndex*this.itemHeight}},itemDown(e){const t=M(e);this.downX=null==t?void 0:t.clientX,this.downY=null==t?void 0:t.clientY,this.upX=null==t?void 0:t.clientX,this.upY=null==t?void 0:t.clientY},itemMove(e){const t=M(e);this.upX=null==t?void 0:t.clientX,this.upY=null==t?void 0:t.clientY},itemUp(e){const{uniqueKey:t}=e.currentTarget.dataset;this.twoPointDistance({x:this.downX,y:this.downY},{x:this.upX,y:this.upY})<10&&(this.currentIndex=t,this.currentScroll=-this.currentIndex*this.itemHeight,this.hasClick=!0)},twoPointDistance:(e,t)=>Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)),getElementIndex:e=>parseInt(e.id,10)}},[["render",function(e,t,i,d,p,m){return u(),r("div",{class:h(["press-picker-view",[i.hasTip?"press-picker-view__tip":"",i.horizontal?"press-picker-view--hor":""]]),onMousedown:t[6]||(t[6]=l(((...e)=>m.mouseDown&&m.mouseDown(...e)),["stop","prevent"])),onMouseup:t[7]||(t[7]=l(((...e)=>m.mouseUp&&m.mouseUp(...e)),["stop","prevent"])),onTouchstart:t[8]||(t[8]=l(((...e)=>m.handleStart&&m.handleStart(...e)),["stop","prevent"])),onTouchmove:t[9]||(t[9]=l(((...e)=>m.handleMove&&m.handleMove(...e)),["stop","prevent"])),onTouchend:t[10]||(t[10]=l(((...e)=>m.handleEnd&&m.handleEnd(...e)),["stop","prevent"]))},[n("div",{ref:"dropListMask",class:"press-picker-view--mask"},null,512),n("div",{ref:"dropListIndicator",class:"press-picker-view--indicator"},null,512),n("div",{ref:"DropListContent",class:"press-picker-view--content",style:s(m.transformStyle)},[n("div",{style:s(m.hiddenUpPartStyle)},null,4),(u(!0),r(o,null,a(m.showingData,((e,i)=>(u(),r("div",{key:i,class:h(["press-picker-view--item",[e.uniqueKey==p.currentIndex?"press-picker-view--item__active":""]]),"data-unique-key":e.uniqueKey,onMousedown:t[0]||(t[0]=(...e)=>m.itemDown&&m.itemDown(...e)),onMousemove:t[1]||(t[1]=(...e)=>m.itemMove&&m.itemMove(...e)),onMouseup:t[2]||(t[2]=(...e)=>m.itemUp&&m.itemUp(...e)),onTouchstart:t[3]||(t[3]=(...e)=>m.itemDown&&m.itemDown(...e)),onTouchmove:t[4]||(t[4]=(...e)=>m.itemMove&&m.itemMove(...e)),onTouchend:t[5]||(t[5]=(...e)=>m.itemUp&&m.itemUp(...e))},c(e.label),43,["data-unique-key"])))),128)),n("div",{style:s(m.hiddenBottomPartStyle)},null,4)],4)],34)}],["__scopeId","data-v-90e60444"]]);const P=t({name:"PressPickerPlus",options:{styleIsolation:"shared"},components:{PickerInner:t({name:"PressPickerInner",options:{...i(!0,!1),styleIsolation:"shared"},components:{PressPopupPlus:p,PressPickerView:x},props:{title:{type:String,default:"",required:!1},arrowIcon:{type:Boolean,default:!1},tip:{type:String,default:"",required:!1},data:{type:Array,default:()=>[],required:!0},current:{type:Object,default:null,required:!1},virtualListThreshold:{type:Number,default:50},horizontal:{type:Boolean,default:!1}},emits:["onSelect","onCancel"],data:()=>({currentIndex:-1}),mounted(){},methods:{t:d,onCurrentIndexChanged(e){this.currentIndex=e},onConfirm(){var e,t;(null==(e=this.$refs)?void 0:e.picker)?this.$emit("onSelect",this.$refs.picker.getCurrentItem()):this.$emit("onSelect",null==(t=this.data)?void 0:t[this.currentIndex])},onCancel(){this.$emit("onCancel")}}},[["render",function(e,t,i,n,s,o){const a=f("PressPickerView"),l=f("PressPopupPlus");return u(),m(l,{"close-icon":!i.arrowIcon,"show-back-arrow":i.arrowIcon,title:i.title,button:o.t("picker.confirm"),mode:"white",horizontal:i.horizontal,"width-number":54,"popup-class":"press-popup-picker",class:h(i.tip?"press-picker__tip":""),onCancel:o.onCancel,onConfirm:o.onConfirm},{default:v((()=>[i.tip?(u(),r("div",{key:0,class:"press-picker--tip"},c(i.tip),1)):w("",!0),y(a,{ref:"picker",data:i.data,"has-tip":!!i.tip,current:i.current,horizontal:i.horizontal,"virtual-list-threshold":i.virtualListThreshold,onCurrentIndexChanged:o.onCurrentIndexChanged},null,8,["data","has-tip","current","horizontal","virtual-list-threshold","onCurrentIndexChanged"])])),_:1},8,["close-icon","show-back-arrow","title","button","horizontal","class","onCancel","onConfirm"])}],["__scopeId","data-v-362a2480"]])},mixins:[g(I,{showProp:!1,propsKeyMap:C})],props:{},emits:["onClickConfirm","confirm","onRemove","cancel"],data:()=>({}),mounted(){this.isFunctionMode||this.showDialog()},methods:{onClickSelect(e){this.$emit("onClickConfirm",e),this.$emit("confirm",e),this.innerShow=!1,this.getPropOrData("confirm")&&this.getPropOrData("confirm")(e),this.promiseCallback("confirm",{item:e}),setTimeout((()=>{this.destroy()}),100)},remove(){this.$emit("onRemove"),this.$emit("cancel"),this.innerShow=!1,this.getPropOrData("cancel")&&this.getPropOrData("cancel")(),this.promiseCallback("cancel"),setTimeout((()=>{this.destroy()}),100)},destroy(){var e,t,i,r;this.isFunctionMode||(null==(e=null==this?void 0:this.$destroy)||e.call(this),document.body.contains(this.$el)&&(null==(r=null==(i=null==(t=this.$el)?void 0:t.parentElement)?void 0:i.removeChild)||r.call(i,this.$el)))}}},[["render",function(e,t,i,r,n,s){const o=f("PickerInner");return e.innerShow?(u(),m(o,{key:0,data:e.getPropOrData("list"),current:e.getPropOrData("current"),title:e.getPropOrData("title"),"arrow-icon":e.getPropOrData("arrowIcon"),tip:e.getPropOrData("tip"),"virtual-list-threshold":e.getPropOrData("virtualListThreshold"),horizontal:e.getPropOrData("horizontal"),onOnCancel:s.remove,onOnSelect:s.onClickSelect},null,8,["data","current","title","arrow-icon","tip","virtual-list-threshold","horizontal","onOnCancel","onOnSelect"])):w("",!0)}]]);export{P};
